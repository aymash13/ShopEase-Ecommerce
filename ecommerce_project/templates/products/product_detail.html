{% extends 'base.html' %}
{% load static %}
{% block title %}{{ product.name }} - E-Commerce{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'products/product_detail.css' %}">

<div class="product-detail-page py-5">
  <div class="container product-container">
    <div class="row g-4">
      
      <!-- 🖼️ Product Image -->
      <div class="col-md-5">
        <div class="product-image-wrapper">
          {% if product.main_image %}
            <img src="{{ product.main_image.url }}" class="main-image img-fluid" id="mainProductImage" alt="{{ product.name }}">
          {% else %}
            <img src="{% static 'images/no-image.jpg' %}" class="main-image img-fluid" id="mainProductImage" alt="No image available">
          {% endif %}
        </div>
        
        <div class="mt-3 d-flex flex-wrap gap-2 product-thumbnails">
          {% for img in images %}
            <img src="{{ img.image.url }}" class="thumb-image" alt="{{ img.alt_text }}">
          {% endfor %}
        </div>
      </div>

      <!-- 📦 Product Details -->
      <div class="col-md-7">
        <h2 class="product-title">{{ product.name }}</h2>
        <p class="product-category">{{ product.category.name }}</p>
        <hr>

        {% if product.is_on_sale %}
          <h4 class="product-price">
            <span class="old-price">₹{{ product.price }}</span>
            <span class="discount-price">₹{{ product.discount_price }}</span>
          </h4>
        {% else %}
          <h4 class="product-price">₹{{ product.price }}</h4>
        {% endif %}

        <p class="product-description">{{ product.description }}</p>

        {% if variants %}
          <h6 class="variant-title">Available Variants:</h6>
          <ul class="variant-list">
            {% for variant in variants %}
              <li>{{ variant.variant_name }}: {{ variant.variant_value }} (+₹{{ variant.additional_price }})</li>
            {% endfor %}
          </ul>
        {% endif %}

        <!-- 🛒 Add to Cart Form -->
        <form action="{% url 'add_to_cart' product.id %}" method="post" class="add-to-cart-form">
          {% csrf_token %}
          <button type="submit" class="btn-add-cart">
            <i class="bi bi-cart-plus"></i> Add to Cart
          </button>
        </form>

        <!-- 🔗 Link to Cart -->
        <a href="{% url 'cart_detail' %}" class="btn-view-cart">View Cart</a>
      </div>

    </div>
  </div>
</div>

<!-- 📜 Script for Image Switching -->
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const mainImage = document.getElementById("mainProductImage");
    const thumbnails = document.querySelectorAll(".thumb-image");

    thumbnails.forEach(thumb => {
      thumb.addEventListener("click", () => {
        mainImage.src = thumb.src;
      });
      thumb.addEventListener("touchstart", () => {
        mainImage.src = thumb.src;
      });
    });
  });
</script>

{% endblock %}
